(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{354:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("导语：之前买过一台阿里云服务器，现在想配置一个ssl证书，现在就收集到的资料进行整理归纳，说一下如何配置一个域名ssl证书。")])]),s._v(" "),a("h2",{attrs:{id:"配置环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置环境准备"}},[s._v("#")]),s._v(" 配置环境准备")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("一台Linux系统的在线服务器")])]),s._v(" "),a("li",[a("p",[s._v("一个经过dns解析可以正常访问的http协议的网站")])])]),s._v(" "),a("h2",{attrs:{id:"配置方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置方法"}},[s._v("#")]),s._v(" 配置方法")]),s._v(" "),a("p",[s._v("这里主要介绍的是免费ssl证书配置，付费证书请访问以下网站购买。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.wosign.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("沃通"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.trustasia.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("亚洲诚信"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("以上两个比较权威。")]),s._v(" "),a("p",[s._v("下面介绍免费配置方法。")]),s._v(" "),a("ul",[a("li",[s._v("ssl免费证书网")]),s._v(" "),a("li",[s._v("cert包进行配置")])]),s._v(" "),a("h3",{attrs:{id:"ssl证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl证书"}},[s._v("#")]),s._v(" ssl证书")]),s._v(" "),a("p",[a("strong",[s._v("ssl证书")]),s._v("是类似于驾驶证、护照的数字证书，遵守ssl协议，由信任的CA机构验证服务器身份后颁发，具有服务器身份验证和数据传输加密功能。很多网站都启用了ssl证书，来确保他们的网站避免信息被获取盗用。")]),s._v(" "),a("p",[s._v("一般来说，ssl证书分为以下三种：")]),s._v(" "),a("ul",[a("li",[s._v("扩展验证型(EV)SSL证书，迄今为止审核最为严格的证书，不仅验证网站服务器身份，还会通过律师函第三方验证；")]),s._v(" "),a("li",[s._v("组织验证型(OV)SSL证书，针对网站域名和所有权进行严格的审查，强化企业信任度；")]),s._v(" "),a("li",[s._v("域名验证型（DV）SSL证书，只验证网站域名所有权的简易型证书，仅能起到网站信息加密的作用，无法验证网站的所有者真实身份。")])]),s._v(" "),a("h3",{attrs:{id:"ssl免费证书网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl免费证书网"}},[s._v("#")]),s._v(" ssl免费证书网")]),s._v(" "),a("p",[s._v("这个网站主要目的还是宣传普及ssl证书，顺便向大众提供免费的基础的ssl申请使用服务。")]),s._v(" "),a("p",[s._v("申请步骤就是：")]),s._v(" "),a("ul",[a("li",[s._v("点击进入"),a("a",{attrs:{href:"https://freessl.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("【官网】"),a("OutboundLink")],1),s._v(",注册账号；")])]),s._v(" "),a("p",[s._v("+进入首页选择证书，这里提供品牌证书和收费证书；")]),s._v(" "),a("p",[s._v("+填写你需要的域名，然后点击创建")]),s._v(" "),a("p",[s._v("这里是具体的申请方法，我就不详细说明了。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://blog.freessl.cn/about-freessl-org-apply-cert-introduce/",target:"_blank",rel:"noopener noreferrer"}},[s._v("申请免费的ssl证书"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://blog.freessl.cn/how-do-i-install-an-ssl-certificate-collection/",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装申请通过的ssl证书"),a("OutboundLink")],1)])])]),s._v(" "),a("h2",{attrs:{id:"linux安装ssl证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux安装ssl证书"}},[s._v("#")]),s._v(" linux安装ssl证书")]),s._v(" "),a("p",[s._v("这个才是本文重点，主要介绍如何在linux系统的服务器上面免费申请ssl证书，并使用nginx进行配置。")]),s._v(" "),a("p",[a("strong",[s._v("证书官网资源")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("certbot"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("letsencrypt"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"下载安装certbot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装certbot"}},[s._v("#")]),s._v(" 下载安装certbot")]),s._v(" "),a("ul",[a("li",[s._v("使用ssh工具登录服务器，然后把安装包下载下来，安装。")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/certbot/certbot/archive/master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" master.zip\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" master\n./certbot-auto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n./certbot-auto certonly "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--webroot")]),s._v(" --agree-tos "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--email")]),s._v(" eg@126.com "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /var/www/eg.com/web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" eg.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"修改nginx配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx配置文件"}},[s._v("#")]),s._v(" 修改nginx配置文件")]),s._v(" "),a("p",[s._v("进入"),a("code",[s._v("/etc/nginx/vhost/")]),s._v(",然后打开配置文件，"),a("code",[s._v("eg.conf")]),s._v("，把80端口改成重写到https，增加443端口的配置。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/nginx/vhost\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" eg.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("下面是简单的配置内容：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name eg.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rewrite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" https://eg.com"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name eg.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  root /var/www/eg.com/web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  index index.html index.php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_certificate "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/letsencrypt/live/eg.com/fullchain.pem"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_certificate_key "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/letsencrypt/live/eg.com/privkey.pem"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_session_cache shared:SSL:1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_session_timeout  10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("RC4:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DHE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.php"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$is_args")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$query_string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  location ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".php$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      fastcgi_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      fastcgi_index index.php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      fastcgi_param SCRIPT_FILENAME "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      include fastcgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h3",{attrs:{id:"重启nginx即可"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx即可"}},[s._v("#")]),s._v(" 重启nginx即可")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这时候打开"),a("code",[s._v("https://eg.com")]),s._v("，你就可以看到小锁，说明配置成功!")]),s._v(" "),a("h3",{attrs:{id:"证书的更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书的更新"}},[s._v("#")]),s._v(" 证书的更新")]),s._v(" "),a("p",[s._v("这种证书一般有效期只有三个月，使用到期要续,到期后发邮件，"),a("code",[s._v("renew")]),s._v("即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/home/certbot-master/certbot-auto renew\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"傻瓜配置安装ssl证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#傻瓜配置安装ssl证书"}},[s._v("#")]),s._v(" 傻瓜配置安装ssl证书")]),s._v(" "),a("p",[s._v("这种方法下载一个yum包，一键即可配置成功，不需要写配置文件，不需要敲命令和输入邮箱域名名称等信息。")]),s._v(" "),a("ul",[a("li",[s._v("下载包")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python2-certbot-nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("开始配置")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--nginx")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("报错的话，安装"),a("code",[s._v("pip install --upgrade --force-reinstall 'requests==2.6.0' urllib3")]),s._v("就可以了。")]),s._v(" "),a("p",[s._v("下面会出现几个选项，选择你要配置的域名序号，然后再输入是否自动配置，然后重启nginx就可以了。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("续期")])]),s._v(" "),a("p",[s._v("执行以下命令便可续期")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot renew --dry-run\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[s._v("#")]),s._v(" 补充")]),s._v(" "),a("p",[s._v("如果提示")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Traceback "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("most recent call last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/certbot"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    from pkg_resources "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" load_entry_point\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3112")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    @_call_aside\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3096")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" _call_aside\n    f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*args, **kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3125")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" _initialize_master_working_set\n    working_set "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" WorkingSet._build_master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("580")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" _build_master\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" cls._build_from_requirements"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__requires__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("593")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" _build_from_requirements\n    dists "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ws.resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reqs, Environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/python2.7/site-packages/pkg_resources/__init__.py"')]),s._v(", line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("781")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" resolve\n    raise DistributionNotFound"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req, requirers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npkg_resources.DistributionNotFound: The "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'urllib3<1.24,>=1.21.1'")]),s._v(" distribution was not found and is required by requests\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("请运行以下方法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip uninstall urllib3\npip uninstall requests\npip uninstall chardet\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" --force-reinstall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'requests==2.6.0'")]),s._v(" urllib3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("或者")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip uninstall urllib3\npip uninstall requests\npip uninstall chardet\nyum remove python-requests\nyum remove python-urllib3\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" --force-reinstall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'requests==2.6.0'")]),s._v(" urllib3\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" certbot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("查看这篇也可以"),a("a",{attrs:{href:"https://github.com/certbot/certbot/issues/5465",target:"_blank",rel:"noopener noreferrer"}},[s._v("certbot证书配置方法报错解决方法"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"补充方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充方法"}},[s._v("#")]),s._v(" 补充方法")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("certbot-auto")]),s._v("脚本安装certbot生成https证书")]),s._v(" "),a("ul",[a("li",[s._v("下载certbot脚本文件")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.eff.org/certbot-auto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("赋予权限")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x certbot-auto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("申请证书")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(" ./certbot-auto certonly "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--standalone")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--email")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx@163.com'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx.com'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("配置泛域名证书")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("certbot-auto certonly  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.xxx.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" xxx.com "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--manual")]),s._v(" --preferred-challenges dns-01  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--server")]),s._v(" https://acme-v02.api.letsencrypt.org/directory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("续期")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 续签")]),s._v("\n./certbot-auto renew\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制续签")]),s._v("\n./certbot-auto renew --force-renew\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("吊销证书")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前机器证书")]),s._v("\ncertbot-auto certificates\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 吊销证书")]),s._v("\n./certbot-auto revoke --cert-path /etc/letsencrypt/live/xxx.com/cert.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reason")]),s._v(" superseded\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("reason有这5种："),a("code",[s._v("unspecified")]),s._v(", "),a("code",[s._v("keycompromise")]),s._v(", "),a("code",[s._v("affiliationchanged")]),s._v(", "),a("code",[s._v("superseded")]),s._v(", "),a("code",[s._v("cessationofoperation")])]),s._v(" "),a("p",[a("code",[s._v("-- reason")]),s._v("表示吊销证书的原因，命令运行成功后，"),a("code",[s._v("/etc/letsencrypt/renewal")]),s._v("、"),a("code",[s._v("/etc/letsencrypt/archive")]),s._v("、"),a("code",[s._v("/etc/letsencrypt/live")]),s._v("下对应的文件都会被删除。")]),s._v(" "),a("p",[a("strong",[s._v("小技巧")]),s._v("：")]),s._v(" "),a("p",[s._v("编写续签脚本。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#program: this is a auto-renew ssl scripts.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#author: Mr.Mark")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#date: 2020-02-19")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#version: v0.0.1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# renew script")]),s._v("\nsystemctl stop nginx\n./certbot-auto renew --force-renew\nsystemctl start nginx\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x renew-certbot.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("加定时任务")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" */2 * /root/renew-cert.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/root/crontab.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"写在最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[s._v("#")]),s._v(" 写在最后")]),s._v(" "),a("p",[s._v("本篇所讲ssl证书配置只是为了开发测试使用，如果是开展正常商务活动和电商交易以及其他企业贸易活动，请配置正规的付费的证书，会比较好。有什么不懂的可以留言。")])])}),[],!1,null,null,null);a.default=n.exports}}]);