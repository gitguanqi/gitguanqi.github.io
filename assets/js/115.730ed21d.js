(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{443:function(s,t,a){"use strict";a.r(t);var e=a(4),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("导语：MySQL是存储网站数据的地方，如果不进行优化的话，会导致请求很慢，响应很慢，影响数据渲染，给产品带来不好的体验，我就自己之前的项目经验，说一下如何进行MySQL数据表方面的优化工作。")])]),s._v(" "),t("h2",{attrs:{id:"目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),t("ul",[t("li",[s._v("硬件配置")]),s._v(" "),t("li",[s._v("服务器参数")]),s._v(" "),t("li",[s._v("数据库设计")]),s._v(" "),t("li",[s._v("sql语句优化")])]),s._v(" "),t("p",[s._v("下面就这四个方面进行阐述，分析总结我在接口项目中进行的优化总结经验方法。")]),s._v(" "),t("h2",{attrs:{id:"硬件配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#硬件配置"}},[s._v("#")]),s._v(" 硬件配置")]),s._v(" "),t("ul",[t("li",[s._v("一般项目")])]),s._v(" "),t("p",[s._v("如果你的项目比较小，预算比较节省，可以使用1C1G1M配置的服务器，安装mysql5.6即可；如果项目比较大，预算充足，可以配置2C4G5M等服务器，安装mysql8即可。我目前使用的是MySQL8版本。")]),s._v(" "),t("ul",[t("li",[s._v("大型项目")])]),s._v(" "),t("p",[s._v("如果数据量压力特别大，可以考虑购买多台服务器，进行读写分离，主从同步，主服务器用来写入，然后同步数据到辅服务器，辅服务器用来读取数据，这样压力会变得小一些，但是给开发工作带来的巨大的负担。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/mysql-ms.jpg",alt:"主从同步"}})]),s._v(" "),t("p",[s._v("可以考虑使用官方的"),t("a",{attrs:{href:"https://downloads.mysql.com/archives/proxy/",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql-proxy"),t("OutboundLink")],1),s._v("来作为一个代理中间件，具体实现方法可以参考这篇文章"),t("a",{attrs:{href:"#mysql-proxy"}},[t("sup",[s._v("1")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/mysql-proxy.jpg",alt:"mysql代理"}})]),s._v(" "),t("h2",{attrs:{id:"服务器参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器参数"}},[s._v("#")]),s._v(" 服务器参数")]),s._v(" "),t("p",[s._v("主要是安装mysql程序后，如果进行配置项优化，以便达到最大性能，发挥出MySQL的优势价值。")]),s._v(" "),t("p",[s._v("在配置文件"),t("code",[s._v("my.ini")]),s._v("或者"),t("code",[s._v("my.cnf")]),s._v("中写入以下参数：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#my.ini")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_connect_errors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\ndefault-storage-engine"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INNODB\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mysql_native_password")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_authentication_plugin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql_native_password\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ngram_token_size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ndefault-time_zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'+8:00'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("包括最大连接数，最大连接错误，密码兼容性，时区设置东八区等。")]),s._v(" "),t("p",[s._v("我觉得这些就基本上可以了，如果你还想进一步优化，可以参考以下文章"),t("a",{attrs:{href:"#mysql-params"}},[t("sup",[s._v("2")])])]),s._v(" "),t("h2",{attrs:{id:"数据库设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库设计"}},[s._v("#")]),s._v(" 数据库设计")]),s._v(" "),t("h3",{attrs:{id:"设计规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设计规范"}},[s._v("#")]),s._v(" 设计规范")]),s._v(" "),t("ul",[t("li",[s._v("范式设计")])]),s._v(" "),t("p",[s._v("当我们进行关系型数据库设计时，要遵循不同的规范，设计出合理的关系型数据库，那么这些不同的规范就会产生不同的范式，越高的范式冗余越小。")]),s._v(" "),t("p",[s._v("目前关系型数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式（4NF）和第五范式（5NF，又称完美范式）。")]),s._v(" "),t("ul",[t("li",[s._v("第三范式")])]),s._v(" "),t("p",[s._v("一般来说，数据库只需要满足第三范式就行了，当然了，这个范式也是人定的，必然有优缺点，你可以根据你自己的实际情况来定义你所采用的规范。")]),s._v(" "),t("p",[s._v("第三范式主要是表中的字段和主键直接对应不依靠其他中间字段，说白了就是，决定某字段值的必须是主键；缺点在于查询时通常需要join很多表，导致查询效率很低。可以适当的进行反范式，进行适当的冗余，以便提高查询效率。")]),s._v(" "),t("h3",{attrs:{id:"最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[s._v("#")]),s._v(" 最佳实践")]),s._v(" "),t("ul",[t("li",[s._v("选择合适的引擎")])]),s._v(" "),t("p",[s._v("MySQL为我们提供的很多的引擎，比如"),t("em",[s._v("myisam")]),s._v("，"),t("em",[s._v("innodb")]),s._v("，"),t("em",[s._v("memory")]),s._v("等，你可以针对不同的存储需求选择最合适你的存储引擎。具体的可以参考这两篇文章："),t("a",{attrs:{href:"#mysql-practice"}},[t("sup",[s._v("3")])])]),s._v(" "),t("p",[s._v("我这个项目选择的是"),t("code",[s._v("innodb")]),s._v("，看中它的自动增长列以及外键约束特性、提交、回滚和崩溃恢复能力等事务安全。")]),s._v(" "),t("ul",[t("li",[s._v("建立适当的索引")])]),s._v(" "),t("p",[s._v("建立一个索引即可，不加内存，不改程序，不调sql")]),s._v(" "),t("ul",[t("li",[s._v("选择适当的字段类型")])]),s._v(" "),t("p",[s._v("比如id可以采用"),t("code",[s._v("int")]),s._v("类型，类型等字段可以采用"),t("code",[s._v("tinyint")]),s._v("；文本内容根据大小优先级可以是"),t("code",[s._v("char")]),s._v(">"),t("code",[s._v("varchar")]),s._v(">"),t("code",[s._v("text")]),s._v("；日期根据存储字节可以是"),t("code",[s._v("timestamp")]),s._v(">"),t("code",[s._v("datetime")]),s._v(">"),t("code",[s._v("date")]),s._v("，文件资源只需要存储在服务器的路径即可。经过以上一系列的字段类型优化，可以有效降低存储大小，字节节省，减轻读写压力，提供数据库性能。")]),s._v(" "),t("ul",[t("li",[s._v("适当时机进行写入")])]),s._v(" "),t("p",[s._v("先写入和后写入都会对数据库产生影响。")]),s._v(" "),t("ul",[t("li",[s._v("尽量批量操作读写")])]),s._v(" "),t("p",[s._v("如果单个频繁的读写，会对服务器产生很大压力，可以采用批量脚本，批量录入数据。")]),s._v(" "),t("ul",[t("li",[s._v("对数据表进行水平和垂直划分")])]),s._v(" "),t("p",[s._v("一个表记录的东西太多，会影响读写效率，可以考虑化整为零，进行逻辑划分，一个表拆成多张表。")]),s._v(" "),t("h2",{attrs:{id:"sql语句优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql语句优化"}},[s._v("#")]),s._v(" sql语句优化")]),s._v(" "),t("p",[s._v("最后一个要优化的地方就是sql语句，一条好的sql语句可以帮助我们实现便捷的curd操作，提高读写效率。")]),s._v(" "),t("ul",[t("li",[s._v("慢日志")])]),s._v(" "),t("p",[s._v("如果某一天发现系统查询变慢了，又找不到原因。可以使用这个进行问题定位，但是由于慢查询日志记录信息较多，会影响mysql的性能，所以生产环境不建议长期开启。")]),s._v(" "),t("p",[s._v("在配置文件"),t("code",[s._v("my.ini")]),s._v("或者"),t("code",[s._v("my.cnf")]),s._v("中写入以下参数。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slow log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1开启 0关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql/data/slow-query.log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 慢查询日志存储文件")]),s._v("\nlong_query_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 慢查询日志的时间定义（秒），默认为10秒，多久就算慢查询的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_queries_not_using_indexes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("语句优化技巧")])]),s._v(" "),t("p",[s._v("避免全表字段查询，可以查询某一个，根据条件。")]),s._v(" "),t("p",[s._v("这里有可以参考下。"),t("a",{attrs:{href:"#mysql-statement"}},[t("sup",[s._v("4")])])]),s._v(" "),t("p",[s._v("对了，我最近写了一个mysql语句生成npm包，有兴趣的可以去了解下，包地址"),t("a",{attrs:{href:"https://www.npmjs.com/package/xqsql",target:"_blank",rel:"noopener noreferrer"}},[s._v("xqsql"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("参考文章：")])]),s._v(" "),t("div",{attrs:{id:"mysql-proxy"}}),s._v(" "),t("ul",[t("li",[s._v("[1]"),t("a",{attrs:{href:"https://blog.csdn.net/qq_15092079/article/details/81672920",target:"_blank",rel:"noopener noreferrer"}},[s._v("《mysql数据库的主从同步，实现读写分离》"),t("OutboundLink")],1)])]),s._v(" "),t("div",{attrs:{id:"mysql-params"}}),s._v(" "),t("ul",[t("li",[s._v("[2]"),t("a",{attrs:{href:"https://www.cnblogs.com/a876459952/p/13268043.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《mysql数据库参数详解》"),t("OutboundLink")],1)])]),s._v(" "),t("div",{attrs:{id:"mysql-practice"}}),s._v(" "),t("ul",[t("li",[s._v("[3]"),t("a",{attrs:{href:"https://blog.csdn.net/qq_16525279/article/details/82773520",target:"_blank",rel:"noopener noreferrer"}},[s._v("《MySQL存储引擎概述&MyISAM&InnoDB&MEMORY》"),t("OutboundLink")],1)])]),s._v(" "),t("div",{attrs:{id:"mysql-statement"}}),s._v(" "),t("ul",[t("li",[s._v("[4]"),t("a",{attrs:{href:"https://www.cnblogs.com/Little-Li/p/8031295.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《30条语句优化技巧》"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("好了，以上就是我做项目过程中，发现的，总结的一些关于mysql优化方面的内容，如果有什么问题，可以底部发我邮箱联系。")])])}),[],!1,null,null,null);t.default=r.exports}}]);